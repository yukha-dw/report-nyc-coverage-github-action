<!-- start title -->

# <img src=".github/ghadocs/branding.svg" width="60px" align="center" alt="branding<icon:activity color:yellow>" /> GitHub Action: Report NYC coverage

<!-- end title -->
<!-- start description -->

GitHub Action that posts the report in a comment on a GitHub Pull Request from coverage data generated by nyc (istanbul).

<!-- end description -->
<!-- start contents -->
<!-- end contents -->

[See sample comment](https://github.com/sidx1024/report-nyc-coverage-github-action/pull/10#issuecomment-1074885726)
<img src="docs/sample-report.png" alt="Sample comment image">

## Setup

Please refer to the folder [.github/workflows](https://github.com/sidx1024/report-nyc-coverage-github-action/tree/main/.github/workflows) to see how this action is used in this repo itself. Use it as a reference for setting it up for your repo.

## Typical Usage

```yaml
on: [pull_request]

jobs:
  my_app_job:
    runs-on: ubuntu-latest
    name: My App
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: 1000 # Set this according to the size of your git history

      - name: Fetch base
        run: git fetch origin ${{ github.event.pull_request.base.ref }} --depth=1000

      - name: Run tests
        run: npm run test

      - name: Generate NYC report
        run: |
          npx nyc report \
            --reporter json-summary \
            --report-dir nyc-coverage-report \
            --exclude-after-remap false

      - name: Report NYC coverage
        uses: sidx1024/report-nyc-coverage-github-action@v1.2.7
        with:
          # Path to coverage file generated by "nyc report".
          coverage_file: "nyc-coverage-report/coverage-summary.json"
```

## Usage

<!-- start usage -->

```yaml
- uses: sidx1024/report-nyc-coverage-github-action@v1.0.0
  with:
    # Description: Path to coverage file generated by "nyc report".
    #
    # Default: coverage-summary.json
    coverage_file: ""

    # Description: Path to coverage file generated by "nyc report" for the base branch
    # (for comparison)
    #
    # Default: .base_nyc_output/coverage-summary.json
    base_coverage_file: ""

    # Description: Template file to be used for GitHub PR comment. Markdown and Svelte
    # are supported.
    #
    # Default: comment-template.md
    comment_template_file: ""

    # Description: "replace" or "new"
    #
    # Default: replace
    comment_mode: ""

    # Description: An alternative GitHub token, other than the default provided by
    # GitHub Actions runner. Optional.
    #
    # Default: ${{ github.token }}
    github_token: ""

    # Description: Absolute path to the source files. The path will be trimmed from
    # the coverage data. Optional. Default is the github workspace directory with a
    # trailing slash.
    #
    # Default: ${{ format('{0}/', github.workspace) }}
    sources_base_path: ""

    # Description: Specify the order for coverage types to be included in the output
    # table. (S: statements, B: branches, F: functions, L: lines). Missing types will
    # be excluded.
    #
    # Default: SBFL
    files_coverage_table_output_type_order: ""
```

<!-- end usage -->
<!-- start inputs -->

| **Input**                                           | **Description**                                                                                                                                                | **Default**                                          | **Required** |
| --------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- | ------------ |
| <code>coverage_file</code>                          | Path to coverage file generated by "nyc report".                                                                                                               | <code>coverage-summary.json</code>                   | **true**     |
| <code>base_coverage_file</code>                     | Path to coverage file generated by "nyc report" for the base branch (for comparison)                                                                           | <code>.base_nyc_output/coverage-summary.json</code>  | **true**     |
| <code>comment_template_file</code>                  | Template file to be used for GitHub PR comment. Markdown and Svelte are supported.                                                                             | <code>comment-template.md</code>                     | **false**    |
| <code>comment_mode</code>                           | "replace" or "new"                                                                                                                                             | <code>replace</code>                                 | **false**    |
| <code>github_token</code>                           | An alternative GitHub token, other than the default provided by GitHub Actions runner. Optional.                                                               | <code>${{ github.token }}</code>                     | **false**    |
| <code>sources_base_path</code>                      | Absolute path to the source files. The path will be trimmed from the coverage data. Optional. Default is the github workspace directory with a trailing slash. | <code>${{ format('{0}/', github.workspace) }}</code> | **false**    |
| <code>files_coverage_table_output_type_order</code> | Specify the order for coverage types to be included in the output table. (S: statements, B: branches, F: functions, L: lines). Missing types will be excluded. | <code>SBFL</code>                                    | **false**    |

<!-- end inputs -->
<!-- start outputs -->

| **Output**                                              | **Description**                                                                                            | **Value** |
| ------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | --------- |
| <code>total_lines_coverage_percent</code>               | Total lines coverage percent (XX.XX%) with level indicator                                                 |           |
| <code>total_branches_coverage_percent</code>            | Total branches coverage percent (XX.XX%) with level indicator                                              |           |
| <code>total_statements_coverage_percent</code>          | Total statements coverage percent (XX.XX%) with level indicator                                            |           |
| <code>total_functions_coverage_percent</code>           | Total functions coverage percent (XX.XX%) with level indicator                                             |           |
| <code>total_lines_coverage_percent_raw</code>           | Total lines coverage percent (XX.XX) without percent and level indicator                                   |           |
| <code>total_branches_coverage_percent_raw</code>        | Total branches coverage percent (XX.XX) without percent and level indicator                                |           |
| <code>total_statements_coverage_percent_raw</code>      | Total statements coverage percent (XX.XX) without percent and level indicator                              |           |
| <code>total_functions_coverage_percent_raw</code>       | Total functions coverage percent (XX.XX) without percent and level indicator                               |           |
| <code>base_total_lines_coverage_percent</code>          | Base total lines coverage percent (XX.XX%) with level indicator                                            |           |
| <code>base_total_branches_coverage_percent</code>       | Base total branches coverage percent (XX.XX%) with level indicator                                         |           |
| <code>base_total_statements_coverage_percent</code>     | Base total statements coverage percent (XX.XX%) with level indicator                                       |           |
| <code>base_total_functions_coverage_percent</code>      | Base total functions coverage percent (XX.XX%) with level indicator                                        |           |
| <code>total_lines_coverage_percent_diff</code>          | Total lines coverage percent diff (+XX.XX%)                                                                |           |
| <code>total_statements_coverage_percent_diff</code>     | Total branches coverage percent diff (+XX.XX%)                                                             |           |
| <code>total_functions_coverage_percent_diff</code>      | Total statements coverage percent diff (+XX.XX%)                                                           |           |
| <code>total_branches_coverage_percent_diff</code>       | Total functions coverage percent diff (+XX.XX%)                                                            |           |
| <code>total_lines_coverage_percent_diff_raw</code>      | Total lines coverage percent diff (-XX.XX) without percent sign                                            |           |
| <code>total_statements_coverage_percent_diff_raw</code> | Total branches coverage percent diff (-XX.XX) without percent sign                                         |           |
| <code>total_functions_coverage_percent_diff_raw</code>  | Total statements coverage percent diff (-XX.XX) without percent sign                                       |           |
| <code>total_branches_coverage_percent_diff_raw</code>   | Total functions coverage percent diff (-XX.XX) without percent sign                                        |           |
| <code>files_coverage_table</code>                       | HTML table content containing the file path and corresponding coverage percent for all files               |           |
| <code>changed_files_coverage_table</code>               | HTML table content containing the file path and corresponding coverage percent for files changed in the PR |           |
| <code>comment_body</code>                               | The comment body in HTML format                                                                            |           |
| <code>commit_sha</code>                                 | Last commit SHA (commit due to which this action was executed)                                             |           |
| <code>short_commit_sha</code>                           | Last commit SHA in shorter format (6ef01b)                                                                 |           |
| <code>commit_link</code>                                | Relative link for the last commit                                                                          |           |
| <code>base_commit_sha</code>                            | Base commit SHA                                                                                            |           |
| <code>base_short_commit_sha</code>                      | Base commit SHA in shorter format (bca317)                                                                 |           |
| <code>base_commit_link</code>                           | Relative link for the base commit                                                                          |           |
| <code>base_ref</code>                                   | Base branch name                                                                                           |           |

<!-- end outputs -->
<!-- start [.github/ghdocs/examples/] -->
<!-- end [.github/ghdocs/examples/] -->
